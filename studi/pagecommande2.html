<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Connexion ~ Vite & Gourmand</title>
    <link rel="stylesheet" type="text/css" href="css/pageconnexion.css">
    <link rel="icon" type="image/x-icon" href="favicon.ico">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Golos+Text:wght@400..900&display=swap');
    </style>
</head>

<body>
    <header>
        <div class="nom_entreprise">
            <p>Vite & Gourmand</p>
        </div>
        <nav class="menu_deroulant">
            <ul>
                <li><a href="pageaccueil.html" class="active">Accueil</a></li>
                <li><a href="pagemenuprincipal.html">Menus</a></li>
                <li><a href="pagecontact.html">Contact</a></li>
                <li><a href="pageconnexion.html" class="btn-connexion">Connexion</a></li>
            </ul>
        </nav>
    </header>
<body>
    <header>
        <div class="header_container">
            <div class="nom_entreprise">
                <div class="logo_icon">üçΩÔ∏è</div>
                <div class="entreprise_texte">
                    <div class="entreprise_nom">Vite & Gourmand</div>
                    <div class="entreprise_slogan">Traiteur depuis 1999</div>
                </div>
            </div>

            <nav class="menu_deroulant">
                <ul>
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="menus.html" class="active">Menus</a></li>
                    <li><a href="contact.html">Contact</a></li>
                    <li><a href="connexion.html" class="btn-connexion">Connexion</a></li>
                </ul>
            </nav>

            <div class="burger_menu" onclick="toggleMenu()">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </header>

    <main class="commande_page">
        <div class="commande_container">
            <div class="commande_header">
                <h1>Commander un menu</h1>
                <p>Remplissez le formulaire ci-dessous pour passer votre commande</p>
            </div>

            <!-- Alerte si non connect√© -->
            <div class="alert alert_warning" id="notLoggedAlert" style="display: none;">
                <span class="alert_icon">‚ö†Ô∏è</span>
                <div>
                    <strong>Connexion requise</strong>
                    <p>Vous devez √™tre connect√© pour passer commande. 
                        <a href="connexion.html">Se connecter</a> ou 
                        <a href="connexion.html#inscription">Cr√©er un compte</a>
                    </p>
                </div>
            </div>

            <form action="backend/create_order.php" method="POST" id="commandeForm" class="commande_form">
                
                <!-- √âtape 1 : Informations client -->
                <div class="form_section">
                    <h2 class="section_title">
                        <span class="step_number">1</span>
                        Vos informations
                    </h2>
                    
                    <div class="form_row">
                        <div class="input_group">
                            <label for="nom">Nom *</label>
                            <input type="text" id="nom" name="nom" required 
                                   value="" placeholder="Dupont">
                        </div>
                        <div class="input_group">
                            <label for="prenom">Pr√©nom *</label>
                            <input type="text" id="prenom" name="prenom" required 
                                   value="" placeholder="Jean">
                        </div>
                    </div>

                    <div class="form_row">
                        <div class="input_group">
                            <label for="email">E-mail *</label>
                            <input type="email" id="email" name="email" required 
                                   value="" placeholder="votre@email.fr">
                        </div>
                        <div class="input_group">
                            <label for="telephone">T√©l√©phone (GSM) *</label>
                            <input type="tel" id="telephone" name="telephone" required 
                                   pattern="[0-9]{10}" placeholder="0612345678">
                        </div>
                    </div>
                </div>

                <!-- √âtape 2 : Informations de livraison -->
                <div class="form_section">
                    <h2 class="section_title">
                        <span class="step_number">2</span>
                        D√©tails de la prestation
                    </h2>

                    <div class="input_group">
                        <label for="adresse_livraison">Adresse de livraison *</label>
                        <input type="text" id="adresse_livraison" name="adresse_livraison" required
                               placeholder="123 Rue de la Gastronomie, 33000 Bordeaux">
                        <small class="input_hint">
                            <span class="icon">‚ÑπÔ∏è</span>
                            Livraison gratuite √† Bordeaux. Hors Bordeaux : 5‚Ç¨ + 0,59‚Ç¨/km
                        </small>
                    </div>

                    <div class="form_row">
                        <div class="input_group">
                            <label for="date_livraison">Date de livraison *</label>
                            <input type="date" id="date_livraison" name="date_livraison" required>
                        </div>
                        <div class="input_group">
                            <label for="heure_livraison">Heure souhait√©e *</label>
                            <input type="time" id="heure_livraison" name="heure_livraison" required>
                        </div>
                    </div>

                    <div class="input_group">
                        <label for="lieu_evenement">Lieu de l'√©v√©nement</label>
                        <input type="text" id="lieu_evenement" name="lieu_evenement" 
                               placeholder="Salle des f√™tes de Bordeaux (optionnel)">
                    </div>
                </div>

                <!-- √âtape 3 : Choix du menu -->
                <div class="form_section">
                    <h2 class="section_title">
                        <span class="step_number">3</span>
                        Choix du menu
                    </h2>

                    <div class="input_group">
                        <label for="menu_id">Menu choisi *</label>
                        <select id="menu_id" name="menu_id" required onchange="updateMenuDetails()">
                            <option value="">-- S√©lectionnez un menu --</option>
                            <option value="1" data-min-persons="20" data-price="45" data-name="Menu de No√´l">Menu de No√´l (45‚Ç¨/pers - min. 20 personnes)</option>
                            <option value="2" data-min-persons="15" data-price="32" data-name="Menu Anniversaire">Menu Anniversaire (32‚Ç¨/pers - min. 15 personnes)</option>
                            <option value="3" data-min-persons="50" data-price="75" data-name="Menu Mariage">Menu Mariage (75‚Ç¨/pers - min. 50 personnes)</option>
                            <option value="4" data-min-persons="30" data-price="28" data-name="Menu Entreprise">Menu Entreprise (28‚Ç¨/pers - min. 30 personnes)</option>
                            <option value="5" data-min-persons="20" data-price="38" data-name="Menu P√¢ques">Menu P√¢ques (38‚Ç¨/pers - min. 20 personnes)</option>
                            <option value="6" data-min-persons="25" data-price="25" data-name="Cocktail D√Ænatoire">Cocktail D√Ænatoire (25‚Ç¨/pers - min. 25 personnes)</option>
                            <option value="7" data-min-persons="20" data-price="22" data-name="Brunch Gourmand">Brunch Gourmand (22‚Ç¨/pers - min. 20 personnes)</option>
                            <option value="8" data-min-persons="25" data-price="30" data-name="Menu Bapt√™me">Menu Bapt√™me (30‚Ç¨/pers - min. 25 personnes)</option>
                            <option value="9" data-min-persons="20" data-price="52" data-name="Menu Vegan">Menu Vegan (52‚Ç¨/pers - min. 20 personnes)</option>
                        </select>
                    </div>

                    <!-- Affichage des conditions du menu -->
                    <div class="menu_conditions" id="menuConditions" style="display: none;">
                        <div class="alert alert_info">
                            <span class="alert_icon">‚ö†Ô∏è</span>
                            <div>
                                <strong>Conditions importantes</strong>
                                <ul id="conditionsList">
                                    <!-- Les conditions seront ajout√©es dynamiquement -->
                                </ul>
                            </div>
                        </div>
                    </div>

                    <div class="input_group">
                        <label for="nb_personnes">Nombre de personnes *</label>
                        <input type="number" id="nb_personnes" name="nb_personnes" required 
                               min="1" value="1" onchange="calculatePrice()">
                        <small class="input_hint" id="minPersonsHint" style="display: none;">
                            <span class="icon">‚ÑπÔ∏è</span>
                            Minimum requis : <span id="minPersonsValue">0</span> personnes
                        </small>
                    </div>

                    <!-- R√©duction affich√©e si applicable -->
                    <div class="discount_info" id="discountInfo" style="display: none;">
                        <span class="discount_badge">üéâ -10%</span>
                        <p>R√©duction de 10% appliqu√©e (plus de 5 personnes au-dessus du minimum)</p>
                    </div>
                </div>

                <!-- √âtape 4 : R√©capitulatif et prix -->
                <div class="form_section">
                    <h2 class="section_title">
                        <span class="step_number">4</span>
                        R√©capitulatif de la commande
                    </h2>

                    <div class="price_summary">
                        <div class="summary_item">
                            <span class="label">Menu s√©lectionn√© :</span>
                            <span class="value" id="selectedMenuName">--</span>
                        </div>
                        <div class="summary_item">
                            <span class="label">Nombre de personnes :</span>
                            <span class="value" id="displayPersons">0</span>
                        </div>
                        <div class="summary_item">
                            <span class="label">Prix unitaire :</span>
                            <span class="value" id="unitPrice">0.00‚Ç¨</span>
                        </div>
                        <div class="summary_item" id="discountRow" style="display: none;">
                            <span class="label">R√©duction (10%) :</span>
                            <span class="value discount" id="discountAmount">- 0.00‚Ç¨</span>
                        </div>
                        <div class="summary_item">
                            <span class="label">Sous-total menu :</span>
                            <span class="value" id="subtotalMenu">0.00‚Ç¨</span>
                        </div>
                        <div class="summary_item">
                            <span class="label">Frais de livraison :</span>
                            <span class="value" id="deliveryFees">√Ä calculer</span>
                        </div>
                        <div class="summary_separator"></div>
                        <div class="summary_item total">
                            <span class="label">TOTAL TTC :</span>
                            <span class="value" id="totalPrice">0.00‚Ç¨</span>
                        </div>
                    </div>
                </div>

                <!-- Notes compl√©mentaires -->
                <div class="form_section">
                    <div class="input_group">
                        <label for="notes">Notes / Demandes sp√©ciales</label>
                        <textarea id="notes" name="notes" rows="4" 
                                  placeholder="Allergies, r√©gimes alimentaires particuliers, demandes sp√©cifiques..."></textarea>
                    </div>
                </div>

                <!-- Validation CGV -->
                <div class="form_checkbox">
                    <label class="checkbox_label">
                        <input type="checkbox" name="accept_cgv" required>
                        <span>J'ai lu et j'accepte les <a href="cgv.html" target="_blank">conditions g√©n√©rales de vente</a> * </span>
                    </label>
                </div>

                <!-- Boutons d'action -->
                <div class="form_actions">
                    <a href="menus.html" class="btn btn_secondary">‚Üê Retour aux menus</a>
                    <button type="submit" class="btn btn_primary">Valider la commande</button>
                </div>
            </form>
        </div>
    </main>

    <footer>
        <div class="cat_footer">
            <div class="contact">
                <h3>Horaires d'ouverture</h3>
                <ul>
                    <li><strong>Lundi - Vendredi :</strong> 9h00 - 18h00</li>
                    <li><strong>Samedi :</strong> 10h00 - 16h00</li>
                    <li><strong>Dimanche :</strong> Ferm√© (sur commande)</li>
                </ul>
                <br>
                <p>üìß contact@vite-et-gourmand.fr</p>
                <p>üìû 05 56 XX XX XX</p>
                <p>üìç Bordeaux, France</p>
            </div>
            <div class="CGV">
                <h3>Informations</h3>
                <ul>
                    <li><a href="cgv.html">Conditions G√©n√©rales de Vente</a></li>
                    <li><a href="politique-confidentialite.html">Politique de confidentialit√©</a></li>
                </ul>
            </div>
            <div class="infos_legales">
                <h3>Mentions l√©gales</h3>
                <ul>
                    <li><a href="mentions-legales.html">Mentions l√©gales</a></li>
                    <li><a href="cookies.html">Politique des cookies</a></li>
                </ul>
            </div>
            <div class="reseaux_redirect">
                <h3>Suivez-nous</h3>
                <div class="social_icons">
                    <a href="#" aria-label="Facebook">üìò</a>
                    <a href="#" aria-label="Instagram">üì∑</a>
                    <a href="#" aria-label="LinkedIn">üíº</a>
                </div>
            </div>
        </div>
        <div class="footer_bottom">
            <p>¬© 2024 Vite & Gourmand - Tous droits r√©serv√©s</p>
        </div>
    </footer>

    <script>
        // Menu burger
        function toggleMenu() {
            const menu = document.querySelector('.menu_deroulant');
            menu.classList.toggle('active');
        }

        // Mise √† jour des d√©tails du menu
        function updateMenuDetails() {
            const select = document.getElementById('menu_id');
            const option = select.options[select.selectedIndex];
            
            if (option.value) {
                const minPersons = parseInt(option.dataset.minPersons);
                const menuName = option.dataset.name;
                
                // Afficher le nom du menu
                document.getElementById('selectedMenuName').textContent = menuName;
                
                // Mettre √† jour le minimum de personnes
                document.getElementById('nb_personnes').min = minPersons;
                document.getElementById('nb_personnes').value = minPersons;
                document.getElementById('minPersonsValue').textContent = minPersons;
                document.getElementById('minPersonsHint').style.display = 'block';
                
                // Afficher les conditions (exemple)
                const conditions = document.getElementById('conditionsList');
                conditions.innerHTML = `
                    <li>Commande √† passer minimum 2 semaines √† l'avance</li>
                    <li>Nombre minimum de personnes : ${minPersons}</li>
                    <li>Conditions d'annulation : voir CGV</li>
                `;
                document.getElementById('menuConditions').style.display = 'block';
                
                calculatePrice();
            } else {
                document.getElementById('menuConditions').style.display = 'none';
                document.getElementById('minPersonsHint').style.display = 'none';
            }
        }

        // Calcul automatique du prix
        function calculatePrice() {
            const select = document.getElementById('menu_id');
            const option = select.options[select.selectedIndex];
            
            if (!option.value) return;
            
            const basePrice = parseFloat(option.dataset.price);
            const minPersons = parseInt(option.dataset.minPersons);
            const nbPersons = parseInt(document.getElementById('nb_personnes').value) || 0;
            
            // V√©rifier le minimum
            if (nbPersons < minPersons) {
                alert(`Attention : le nombre minimum de personnes pour ce menu est de ${minPersons}.`);
                document.getElementById('nb_personnes').value = minPersons;
                return;
            }
            
            // Calculer le prix de base
            let subtotal = basePrice * nbPersons;
            let discountAmount = 0;
            
            // Appliquer la r√©duction de 10% si > minPersons + 5
            if (nbPersons > (minPersons + 5)) {
                discountAmount = subtotal * 0.10;
                subtotal -= discountAmount;
                document.getElementById('discountInfo').style.display = 'block';
                document.getElementById('discountRow').style.display = 'flex';
                document.getElementById('discountAmount').textContent = `- ${discountAmount.toFixed(2)}‚Ç¨`;
            } else {
                document.getElementById('discountInfo').style.display = 'none';
                document.getElementById('discountRow').style.display = 'none';
            }
            
            // Mise √† jour de l'affichage
            document.getElementById('displayPersons').textContent = nbPersons;
            document.getElementById('unitPrice').textContent = `${basePrice.toFixed(2)}‚Ç¨`;
            document.getElementById('subtotalMenu').textContent = `${subtotal.toFixed(2)}‚Ç¨`;
            
            // Frais de livraison (√† calculer via l'adresse - simplifi√© ici)
            const deliveryFee = 5.00; // Exemple simplifi√©
            document.getElementById('deliveryFees').textContent = `${deliveryFee.toFixed(2)}‚Ç¨`;
            
            // Total
            const total = subtotal + deliveryFee;
            document.getElementById('totalPrice').textContent = `${total.toFixed(2)}‚Ç¨`;
        }

        // V√©rifier si l'utilisateur est connect√© (simul√©)
        window.onload = function() {
            // TODO: V√©rifier la session utilisateur via backend
            const isLoggedIn = false; // √Ä remplacer par une vraie v√©rification
            
            if (!isLoggedIn) {
                document.getElementById('notLoggedAlert').style.display = 'flex';
            }
            
            // Pr√©-remplir le menu si pass√© en param√®tre URL
            const urlParams = new URLSearchParams(window.location.search);
            const menuId = urlParams.get('menu');
            if (menuId) {
                document.getElementById('menu_id').value = menuId;
                updateMenuDetails();
            }
            
            // D√©finir la date minimum (aujourd'hui + 2 semaines)
            const today = new Date();
            today.setDate(today.getDate() + 14);
            document.getElementById('date_livraison').min = today.toISOString().split('T')[0];
        };
    </script>
</body>

</html>